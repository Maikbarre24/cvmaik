<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAIK - CV Responsive</title>

    <!-- LIBRERIE -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #2d3748;
            line-height: 1.6;
            min-height: 100vh;
            padding: 15px;
        }

        /* RESPONSIVE CONTAINER */
        .container {
            max-width: 1350px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        @media (min-width: 768px) {
            .container { grid-template-columns: 1fr 1fr; gap: 25px; }
        }

        .form-section, .preview-section {
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        @media (min-width: 768px) {
            .form-section, .preview-section { padding: 30px; }
        }

        h1 {
            text-align: center;
            color: white;
            font-size: 2.2rem;
            margin-bottom: 15px;
            font-weight: 700;
            text-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        @media (min-width: 768px) { h1 { font-size: 2.8rem; margin-bottom: 20px; } }

        h2 {
            color: #5a67d8;
            font-size: 1.4rem;
            border-left: 4px solid #5a67d8;
            padding-left: 12px;
            margin-bottom: 18px;
            font-weight: 600;
        }

        .form-group { margin-bottom: 16px; }
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            color: #4a5568;
            font-size: 0.9rem;
        }
        input, textarea, select {
            width: 100%;
            padding: 11px 13px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 14px;
            background: #f8fafc;
            transition: all 0.3s ease;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #5a67d8;
            box-shadow: 0 0 0 4px rgba(90, 103, 216, 0.15);
            background: white;
        }
        textarea { resize: vertical; min-height: 65px; }

        .photo-upload {
            text-align: center;
            padding: 20px;
            border: 3px dashed #a0aec0;
            border-radius: 14px;
            background: #f7fafc;
            cursor: pointer;
            margin-bottom: 18px;
            font-size: 0.9rem;
        }
        .photo-upload:hover { border-color: #5a67d8; background: #edf2f7; }
        .photo-preview {
            width: 90px;
            height: 110px;
            object-fit: cover;
            margin: 10px auto 0;
            border: 4px solid #5a67d8;
            border-radius: 14px;
            display: none;
            box-shadow: 0 6px 18px rgba(90, 103, 216, 0.3);
        }
        @media (min-width: 768px) {
            .photo-preview { width: 100px; height: 120px; }
        }

        .ai-section {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 18px;
            border-radius: 14px;
            margin-bottom: 20px;
        }
        .ai-section h3 { margin-bottom: 10px; font-size: 1.1rem; }
        .ai-controls {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 8px;
            margin-top: 8px;
        }
        .btn-ai {
            background: white;
            color: #667eea;
            border: none;
            padding: 9px 14px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.85rem;
        }
        .btn-ai:hover { background: #f7fafc; }

        .btn {
            background: linear-gradient(135deg, #5a67d8, #4c51bf);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 700;
            width: 100%;
            margin-top: 12px;
            box-shadow: 0 6px 18px rgba(90, 103, 216, 0.3);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 22px rgba(90, 103, 216, 0.4); }
        .btn-success { background: linear-gradient(135deg, #48bb78, #38a169); }
        .btn-print { background: linear-gradient(135deg, #f6ad55, #f57c00); color: #1a202c; }
        .btn-pdf { background: linear-gradient(135deg, #e53e3e, #c53030); }

        .test-section {
            background: #c6f6d5;
            padding: 16px;
            border-radius: 14px;
            margin-bottom: 18px;
            border-left: 5px solid #48bb78;
        }
        .test-result {
            margin-top: 10px;
            padding: 8px;
            border-radius: 10px;
            font-weight: bold;
            text-align: center;
            font-size: 0.9rem;
        }

        .preview-container {
            max-height: 70vh;
            overflow-y: auto;
            border-radius: 14px;
            padding: 16px;
            background: #f8fafc;
            box-shadow: inset 0 0 18px rgba(0,0,0,0.05);
        }
        @media (min-width: 768px) { .preview-container { max-height: 800px; } }

        /* CV RESPONSIVE 1 PAGINA */
        .cv-responsive {
            width: 100%;
            max-width: 210mm;
            min-height: 297mm;
            background: white;
            padding: 15mm;
            margin: 0 auto;
            font-size: 10pt;
            line-height: 1.5;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        @media (min-width: 768px) {
            .cv-responsive { padding: 18mm; font-size: 10.5pt; }
        }

        .cv-responsive::before {
            content: 'MAIK';
            position: absolute;
            top: 6mm;
            left: 50%;
            transform: translateX(-50%);
            font-size: 45pt;
            color: rgba(90, 103, 216, 0.05);
            font-weight: 900;
            letter-spacing: 6px;
            z-index: 1;
            pointer-events: none;
        }
        @media (min-width: 768px) { .cv-responsive::before { font-size: 50pt; } }

        .cv-header {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 14mm;
            position: relative;
            z-index: 2;
        }
        @media (min-width: 768px) {
            .cv-header { flex-direction: row; justify-content: space-between; align-items: flex-start; }
        }

        .cv-info h1 {
            font-size: 24pt;
            color: #1a202c;
            margin: 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        @media (min-width: 768px) { .cv-info h1 { font-size: 28pt; } }

        .cv-info h2 {
            font-size: 15pt;
            color: #5a67d8;
            margin: 0 0 8pt;
            font-weight: 600;
        }
        @media (min-width: 768px) { .cv-info h2 { font-size: 16pt; } }

        .cv-contact {
            font-size: 9pt;
            color: #4a5568;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            gap: 3pt;
        }
        @media (min-width: 768px) { .cv-contact { font-size: 9.5pt; } }

        .cv-contact i {
            color: #5a67d8;
            margin-right: 6px;
            width: 14px;
            text-align: center;
        }

        .cv-photo {
            width: 85px;
            height: 105px;
            object-fit: cover;
            border: 4px solid white;
            border-radius: 14px;
            box-shadow: 0 6px 18px rgba(90, 103, 216, 0.3);
            align-self: center;
        }
        @media (min-width: 768px) {
            .cv-photo { width: 95px; height: 115px; align-self: flex-start; }
        }

        .cv-body {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr;
            gap: 14mm;
            font-size: 9.5pt;
        }
        @media (min-width: 768px) {
            .cv-body { grid-template-columns: 1fr 1fr; gap: 16mm; }
        }

        .cv-left, .cv-right {
            display: flex;
            flex-direction: column;
            gap: 10mm;
        }

        .cv-section h3 {
            font-size: 12.5pt;
            color: #1a202c;
            margin-bottom: 7pt;
            font-weight: 700;
            position: relative;
            padding-left: 18px;
        }
        @media (min-width: 768px) { .cv-section h3 { font-size: 13pt; } }

        .cv-section h3::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 11px;
            height: 11px;
            background: #5a67d8;
            border-radius: 50%;
        }

        .cv-text {
            font-size: 9.3pt;
            color: #2d3748;
            text-align: justify;
            margin-bottom: 7pt;
        }

        .experience-item {
            margin-bottom: 8pt;
            position: relative;
            padding-left: 16px;
        }

        .experience-item::before {
            content: '';
            position: absolute;
            left: 4px;
            top: 6px;
            width: 6px;
            height: 6px;
            background: #5a67d8;
            border-radius: 50%;
        }

        .item-title {
            font-weight: 700;
            color: #1a202c;
            font-size: 10pt;
            margin-bottom: 2pt;
        }

        .item-subtitle {
            color: #5a67d8;
            font-size: 9pt;
            font-style: italic;
            margin-bottom: 3pt;
        }

        .skills-container {
            display: flex;
            flex-wrap: wrap;
            gap: 7px;
            margin-top: 7pt;
        }

        .skill-tag {
            background: #e6f7ff;
            color: #0969da;
            padding: 4px 10px;
            border-radius: 18px;
            font-size: 8.5pt;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(9, 105, 218, 0.15);
        }

        .languages-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 5pt;
        }

        .languages-list li {
            background: #f7fafc;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 8.5pt;
            color: #4a5568;
            border: 1px solid #e2e8f0;
        }

        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 14px 24px;
            background: #48bb78;
            color: white;
            border-radius: 12px;
            font-weight: bold;
            z-index: 1000;
            display: none;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            font-size: 0.9rem;
            max-width: 90%;
            text-align: center;
        }
        @media (min-width: 768px) {
            .notification { top: 20px; right: 20px; left: auto; transform: none; }
        }
        .notification.error { background: #f56565; }
        .notification.info { background: #5a67d8; }

        /* STAMPA 1 PAGINA */
        @media print {
            body, .form-section, .notification, .btn, .test-section { display: none !important; }
            .preview-section { all: unset; width: 100%; padding: 0; }
            .cv-responsive {
                width: 100% !important;
                min-height: auto !important;
                padding: 12mm !important;
                margin: 0 !important;
                box-shadow: none !important;
            }
            @page { size: A4; margin: 0; }
        }
    </style>
</head>
<body>

<h1>MAIK</h1>
<p style="text-align:center;color:white;font-size:1.1rem;opacity:0.9;margin-bottom:15px;">
    CV GENERATO DA MAIK – CANVA STYLE
</p>

<div class="container">
    <!-- FORM -->
    <div class="form-section">
        <h2>MAIK DATI</h2>

        <!-- TEST -->
        <div class="test-section">
            <h3>MAIK TEST</h3>
            <button class="btn" onclick="runTest()" style="width:auto;padding:10px 18px;margin-top:8px;font-size:0.85rem;">
                AVVIA TEST MAIK
            </button>
            <div id="testResult" class="test-result"></div>
        </div>

        <!-- OLLAMA -->
        <div class="ai-section">
            <h3>MAIK AI</h3>
            <div class="form-group">
                <label>MAIK URL</label>
                <input type="text" id="ollamaUrl" value="http://localhost:11434">
            </div>
            <div class="form-group">
                <label>MAIK MODELLO</label>
                <select id="ollamaModel">
                    <option value="llama2">llama2</option>
                </select>
            </div>
        </div>

        <!-- FOTO -->
        <div class="photo-upload" onclick="document.getElementById('photoInput').click()">
            <div style="font-size:38px;">MAIK FOTO</div>
            <p style="margin:6px 0 0; color:#718096; font-size:0.85rem;">CLICCA PER CARICARE</p>
            <input type="file" id="photoInput" accept="image/*" style="display:none;">
        </div>
        <img id="photoPreview" class="photo-preview" alt="MAIK FOTO">

        <!-- CAMPI -->
        <div class="form-group">
            <label>MAIK NOME *</label>
            <input type="text" id="fullName" value="Michael Jose Barreto Padilla">
        </div>
        <div class="form-group">
            <label>MAIK RUOLO *</label>
            <input type="text" id="jobTitle" value="Sviluppatore Full Stack">
        </div>
        <div class="form-group">
            <label>MAIK EMAIL *</label>
            <input type="email" id="email" value="maikbarre3000@gmail.com">
        </div>
        <div class="form-group">
            <label>MAIK TEL</label>
            <input type="tel" id="phone" value="+39 351 054 672">
        </div>
        <div class="form-group">
            <label>MAIK LOCALITÀ</label>
            <input type="text" id="location" value="Italia">
        </div>

        <div class="form-group">
            <label>MAIK PROFILO</label>
            <textarea id="profile">Sviluppatore Full Stack generato da MAIK.</textarea>
            <div class="ai-controls">
                <input type="text" id="profilePrompt" placeholder="MAIK: scrivi...">
                <button class="btn-ai" onclick="generateAI('profile')">MAIK AI</button>
            </div>
        </div>

        <div class="form-group">
            <label>MAIK ESPERIENZE *</label>
            <textarea id="experience">• Sviluppatore Full Stack - Tech SRL (2021-Oggi)</textarea>
            <div class="ai-controls">
                <input type="text" id="experiencePrompt" placeholder="MAIK: descrivi...">
                <button class="btn-ai" onclick="generateAI('experience')">MAIK AI</button>
            </div>
        </div>

        <div class="form-group">
            <label>MAIK FORMAZIONE</label>
            <textarea id="education">• Laurea in Informatica - Università di Milano</textarea>
            <div class="ai-controls">
                <input type="text" id="educationPrompt" placeholder="MAIK: aggiungi...">
                <button class="btn-ai" onclick="generateAI('education')">MAIK AI</button>
            </div>
        </div>

        <div class="form-group">
            <label>MAIK COMPETENZE</label>
            <input type="text" id="skills" value="JavaScript, React, Node.js, Python">
        </div>

        <div class="form-group">
            <label>MAIK LINGUE</label>
            <input type="text" id="languages" value="Italiano: C2, Inglese: C1">
        </div>

        <button class="btn" onclick="updateCV()">MAIK UPDATE</button>
    </div>

    <!-- ANTEPRIMA -->
    <div class="preview-section">
        <h2>MAIK ANTEPRIMA</h2>
        <div class="preview-container">
            <div class="cv-responsive" id="cvContent"></div>
        </div>
        <button class="btn btn-success" onclick="downloadPDF()">MAIK PDF</button>
        <button class="btn btn-print" onclick="printCV()">MAIK STAMPA</button>
    </div>
</div>

<div class="notification" id="notif"></div>

<script>
// FOTO
document.getElementById('photoInput').addEventListener('change', e => {
    if (e.target.files[0]) {
        const reader = new FileReader();
        reader.onload = ev => {
            const img = document.getElementById('photoPreview');
            img.src = ev.target.result;
            img.style.display = 'block';
            updateCV();
        };
        reader.readAsDataURL(e.target.files[0]);
    }
});

// TEST
async function runTest() {
    const result = document.getElementById('testResult');
    result.innerHTML = 'MAIK TEST...';
    const tests = [];

    try {
        const url = document.getElementById('ollamaUrl').value;
        const res = await fetch(`${url}/api/tags`);
        tests.push(res.ok ? 'MAIK AI OK' : 'MAIK AI NO');
    } catch { tests.push('MAIK AI OFF'); }

    updateCV();
    setTimeout(() => {
        const cv = document.getElementById('cvContent').innerHTML;
        tests.push(cv.includes('MAIK') ? 'MAIK CV OK' : 'MAIK CV VUOTO');
        const allOk = tests.every(t => t.includes('OK'));
        result.innerHTML = allOk ? '<div class="test-ok">MAIK: ONLINE</div>' : tests.join('<br>');
    }, 300);
}

// AI
async function generateAI(field) {
    const prompt = document.getElementById(field + 'Prompt').value.trim();
    if (!prompt) return showNotif('MAIK: INSERISCI PROMPT!', 'error');

    showNotif('MAIK AI AL LAVORO...', 'info');
    try {
        const url = document.getElementById('ollamaUrl').value;
        const job = document.getElementById('jobTitle').value || 'sviluppatore';
        const fullPrompt = `MAIK: Scrivi in italiano solo il testo per "${field}" di un CV di un ${job}. Richiesta: "${prompt}".`;

        const res = await fetch(`${url}/api/generate`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ model: 'llama2', prompt: fullPrompt, stream: false })
        });

        const data = await res.json();
        document.getElementById(field).value = data.response?.trim() || prompt;
        updateCV();
        showNotif('MAIK: GENERATO!', 'success');
    } catch {
        const fallbacks = {
            profile: `MAIK: ${job} con ${prompt}.`,
            experience: `• MAIK Developer - Azienda (2021-Oggi)\n  ${prompt}`,
            education: `• Laurea in Informatica\n  ${prompt}`
        };
        document.getElementById(field).value = fallbacks[field];
        updateCV();
        showNotif('MAIK: OFFLINE → ESEMPIO', 'error');
    }
}

// AGGIORNA CV
function updateCV() {
    const d = {
        name: document.getElementById('fullName').value || 'MAIK',
        role: document.getElementById('jobTitle').value || 'MAIK DEV',
        email: document.getElementById('email').value || 'maik@ai.com',
        phone: document.getElementById('phone').value,
        location: document.getElementById('location').value,
        profile: document.getElementById('profile').value,
        experience: document.getElementById('experience').value,
        education: document.getElementById('education').value,
        skills: document.getElementById('skills').value,
        languages: document.getElementById('languages').value,
        photo: document.getElementById('photoPreview').src
    };

    const photo = d.photo && d.photo !== location.href ? `<img src="${d.photo}" class="cv-photo">` : '';
    const skills = d.skills.split(',').map(s => s.trim()).filter(s => s).map(s => `<div class="skill-tag">${s}</div>`).join('');

    let html = `
    <div class="cv-header">
        <div class="cv-info">
            <h1>${d.name}</h1>
            <h2>${d.role}</h2>
            <div class="cv-contact">
                <div><i class="fas fa-envelope"></i> ${d.email}</div>
                ${d.phone ? `<div><i class="fas fa-phone"></i> ${d.phone}</div>` : ''}
                ${d.location ? `<div><i class="fas fa-map-marker-alt"></i> ${d.location}</div>` : ''}
            </div>
        </div>
        ${photo}
    </div>

    <div class="cv-body">
        <div class="cv-left">
            ${d.profile ? `<div class="cv-section"><h3>MAIK PROFILO</h3><div class="cv-text">${d.profile.replace(/\n/g, '<br>')}</div></div>` : ''}
            ${d.experience ? `<div class="cv-section"><h3>MAIK ESPERIENZE</h3><div class="cv-text">${d.experience.replace(/\n/g, '<br>')}</div></div>` : ''}
        </div>
        <div class="cv-right">
            ${d.education ? `<div class="cv-section"><h3>MAIK FORMAZIONE</h3><div class="cv-text">${d.education.replace(/\n/g, '<br>')}</div></div>` : ''}
            ${d.skills ? `<div class="cv-section"><h3>MAIK COMPETENZE</h3><div class="skills-container">${skills}</div></div>` : ''}
            ${d.languages ? `<div class="cv-section"><h3>MAIK LINGUE</h3><ul class="languages-list">${d.languages.split(',').map(l => `<li>${l.trim()}</li>`).join('')}</ul></div>` : ''}
        </div>
    </div>`;

    document.getElementById('cvContent').innerHTML = html;
}

// PDF
async function downloadPDF() {
    showNotif('MAIK: PDF IN DOWNLOAD...', 'info');
    const element = document.getElementById('cvContent');
    try {
        const canvas = await html2canvas(element, { scale: 2, useCORS: true });
        const imgData = canvas.toDataURL('image/jpeg', 1.0);
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');
        pdf.addImage(imgData, 'JPEG', 0, 0, 210, 297);
        pdf.save(`MAIK_CV.pdf`);
        showNotif('MAIK: PDF PRONTO!', 'success');
    } catch { showNotif('MAIK: ERRORE PDF', 'error'); }
}

// STAMPA
function printCV() {
    showNotif('MAIK: STAMPA A4...', 'info');
    window.print();
}

// NOTIF
function showNotif(msg, type = 'info') {
    const n = document.getElementById('notif');
    n.textContent = msg;
    n.className = `notification ${type}`;
    n.style.display = 'block';
    setTimeout(() => n.style.display = 'none', 3000);
}

// INIT
document.addEventListener('DOMContentLoaded', () => {
    updateCV();
    document.querySelectorAll('input, textarea').forEach(el => el.addEventListener('input', updateCV));
    showNotif('MAIK ONLINE', 'success');
});
</script>

</body>
</html>
