<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV AI Premium - Con Ollama Gratuita</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
            --success: #27ae60;
            --warning: #f39c12;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .ai-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--success), #2ecc71);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 10px;
        }

        .app-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .app-layout {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
            background: #fafafa;
        }

        .upload-area:hover {
            border-color: var(--secondary);
            background: #f0f8ff;
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--secondary);
        }

        .photo-preview {
            max-width: 150px;
            max-height: 180px;
            border-radius: 10px;
            margin: 15px auto;
            border: 3px solid var(--secondary);
            display: none;
        }

        .form-group {
            margin: 20px 0;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        textarea {
            height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #219a52;
        }

        .btn-large {
            padding: 18px 40px;
            font-size: 1.1rem;
            width: 100%;
            margin: 20px 0;
        }

        .loading {
            text-align: center;
            padding: 30px;
            display: none;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--secondary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            display: none;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .success { background: var(--success); }
        .error { background: var(--accent); }
        .warning { background: var(--warning); }
        .info { background: var(--secondary); }

        .cv-preview {
            background: white;
            border-radius: 15px;
            padding: 0;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        .preview-container {
            padding: 30px;
            min-height: 600px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .cv-template {
            background: white;
            border-radius: 10px;
            padding: 30px;
            min-height: 500px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .cv-header {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 30px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--light);
        }

        .cv-name {
            font-size: 2rem;
            color: var(--primary);
            font-weight: bold;
            margin-bottom: 5px;
        }

        .cv-role {
            font-size: 1.2rem;
            color: var(--secondary);
            font-weight: 600;
        }

        .cv-photo {
            width: 120px;
            height: 140px;
            border-radius: 8px;
            object-fit: cover;
            border: 3px solid var(--secondary);
        }

        .cv-section {
            margin-bottom: 25px;
        }

        .section-title {
            color: var(--primary);
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--secondary);
        }

        .section-content {
            line-height: 1.6;
            color: var(--dark);
        }

        .skill-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .skill-tag {
            background: var(--light);
            color: var(--primary);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .feature {
            text-align: center;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            color: white;
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .ollama-config {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            color: white;
        }

        .config-toggle {
            background: none;
            border: 2px solid white;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 15px;
        }

        .config-content {
            display: none;
        }

        .config-content.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® CV AI Premium</h1>
            <p>Generatore intelligente di CV con Ollama gratuita</p>
            <div class="ai-badge">ü§ñ IA LOCALE INTEGRATA</div>
        </div>

        <!-- Features -->
        <div class="features">
            <div class="feature">
                <div class="feature-icon">ü§ñ</div>
                <h3>Ollama Gratuita</h3>
                <p>IA locale senza costi</p>
            </div>
            <div class="feature">
                <div class="feature-icon">üé®</div>
                <h3>Design Premium</h3>
                <p>Layout moderno e professionale</p>
            </div>
            <div class="feature">
                <div class="feature-icon">‚ö°</div>
                <h3>Elaborazione AI</h3>
                <p>CV ottimizzati automaticamente</p>
            </div>
            <div class="feature">
                <div class="feature-icon">üìÑ</div>
                <h3>PDF Professionale</h3>
                <p>Download immediato</p>
            </div>
        </div>

        <!-- Ollama Configuration -->
        <div class="ollama-config">
            <button class="config-toggle" onclick="toggleConfig()">‚öôÔ∏è Configurazione Ollama</button>
            <div class="config-content" id="configContent">
                <div class="form-group">
                    <label for="ollamaUrl">URL Ollama (default: http://localhost:11434)</label>
                    <input type="text" id="ollamaUrl" value="http://localhost:11434" placeholder="http://localhost:11434">
                </div>
                <div class="form-group">
                    <label for="ollamaModel">Modello Ollama</label>
                    <select id="ollamaModel">
                        <option value="llama2">Llama 2</option>
                        <option value="mistral">Mistral</option>
                        <option value="codellama">CodeLlama</option>
                        <option value="llama2-uncensored">Llama 2 Uncensored</option>
                    </select>
                </div>
                <button class="btn btn-success" onclick="testOllama()">Test Connessione Ollama</button>
            </div>
        </div>

        <div class="app-layout">
            <!-- Input Section -->
            <div class="card">
                <h2>üìù Inserisci i tuoi dati</h2>
                
                <div class="upload-area" id="photoUploadArea">
                    <div class="upload-icon">üì∏</div>
                    <h3>Carica la tua foto (opzionale)</h3>
                    <p>Trascina o clicca per selezionare</p>
                    <input type="file" id="photoFile" accept="image/*" style="display: none;">
                </div>
                <img id="photoPreview" class="photo-preview" alt="Anteprima foto">

                <div class="form-group">
                    <label for="userName">Nome e Cognome *</label>
                    <input type="text" id="userName" placeholder="Mario Rossi" required>
                </div>

                <div class="form-group">
                    <label for="targetRole">Ruolo desiderato *</label>
                    <input type="text" id="targetRole" placeholder="Es: Sviluppatore Full Stack, Data Scientist..." required>
                </div>

                <div class="form-group">
                    <label for="userEmail">Email *</label>
                    <input type="email" id="userEmail" placeholder="mario.rossi@email.com" required>
                </div>

                <div class="form-group">
                    <label for="userPhone">Telefono</label>
                    <input type="tel" id="userPhone" placeholder="+39 123 456 789">
                </div>

                <div class="form-group">
                    <label for="userExperience">Esperienze professionali *</label>
                    <textarea id="userExperience" placeholder="Descrivi le tue esperienze lavorative, progetti, responsabilit√†..."></textarea>
                </div>

                <div class="form-group">
                    <label for="userEducation">Formazione</label>
                    <textarea id="userEducation" placeholder="Titoli di studio, corsi, certificazioni..."></textarea>
                </div>

                <div class="form-group">
                    <label for="userSkills">Competenze (separate da virgola)</label>
                    <input type="text" id="userSkills" placeholder="JavaScript, React, Node.js, Python, SQL...">
                </div>

                <div class="form-group">
                    <label for="userLanguages">Lingue</label>
                    <input type="text" id="userLanguages" placeholder="Italiano (madrelingua), Inglese (C1)...">
                </div>

                <button class="btn btn-success btn-large" onclick="generateCVWithAI()">
                    ü§ñ GENERA CV CON INTELLIGENZA ARTIFICIALE
                </button>

                <div class="loading" id="loadingAI">
                    <div class="spinner"></div>
                    <h3>L'IA sta migliorando il tuo CV...</h3>
                    <p>Ollama sta ottimizzando contenuti e formattazione</p>
                </div>
            </div>

            <!-- Preview Section -->
            <div class="card cv-preview">
                <h2>üëÅÔ∏è Anteprima CV</h2>
                <div class="preview-container">
                    <div class="cv-template" id="cvTemplate">
                        <div class="cv-header">
                            <div>
                                <div class="cv-name" id="previewName">Nome Cognome</div>
                                <div class="cv-role" id="previewRole">Ruolo Professionale</div>
                            </div>
                            <img id="previewPhoto" class="cv-photo" style="display: none;">
                        </div>

                        <div class="cv-section">
                            <div class="section-title">Profilo Professionale</div>
                            <div class="section-content" id="previewProfile">
                                Inserisci i tuoi dati e genera il CV con l'IA per vedere l'anteprima.
                            </div>
                        </div>

                        <div class="cv-section">
                            <div class="section-title">Esperienze Professionali</div>
                            <div class="section-content" id="previewExperience">
                                Le tue esperienze appariranno qui.
                            </div>
                        </div>

                        <div class="cv-section">
                            <div class="section-title">Formazione</div>
                            <div class="section-content" id="previewEducation">
                                Il tuo percorso formativo apparir√† qui.
                            </div>
                        </div>

                        <div class="cv-section">
                            <div class="section-title">Competenze</div>
                            <div class="section-content">
                                <div class="skill-tags" id="previewSkills">
                                    <div class="skill-tag">Competenze</div>
                                </div>
                            </div>
                        </div>

                        <div class="cv-section">
                            <div class="section-title">Lingue</div>
                            <div class="section-content" id="previewLanguages">
                                Italiano (madrelingua)
                            </div>
                        </div>
                    </div>
                </div>

                <button class="btn btn-large" onclick="downloadPDF()" id="downloadBtn" style="display: none;">
                    üíæ SCARICA PDF
                </button>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // Configurazione Ollama
        let ollamaUrl = 'http://localhost:11434';
        let ollamaModel = 'llama2';

        function toggleConfig() {
            document.getElementById('configContent').classList.toggle('show');
        }

        function updateOllamaConfig() {
            ollamaUrl = document.getElementById('ollamaUrl').value;
            ollamaModel = document.getElementById('ollamaModel').value;
        }

        // Test connessione Ollama
        async function testOllama() {
            updateOllamaConfig();
            showNotification('Test connessione Ollama in corso...', 'info');
            
            try {
                const response = await fetch(`${ollamaUrl}/api/tags`);
                if (response.ok) {
                    showNotification('‚úÖ Ollama connesso con successo!', 'success');
                } else {
                    throw new Error('Ollama non raggiungibile');
                }
            } catch (error) {
                showNotification('‚ùå Errore connessione Ollama: ' + error.message, 'error');
            }
        }

        // Gestione upload foto
        document.getElementById('photoUploadArea').addEventListener('click', () => {
            document.getElementById('photoFile').click();
        });

        document.getElementById('photoFile').addEventListener('change', function(e) {
            if (this.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('photoPreview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                }
                reader.readAsDataURL(this.files[0]);
            }
        });

        // Generazione CV con IA
        async function generateCVWithAI() {
            const userName = document.getElementById('userName').value;
            const targetRole = document.getElementById('targetRole').value;
            const userEmail = document.getElementById('userEmail').value;
            const userPhone = document.getElementById('userPhone').value;
            const userExperience = document.getElementById('userExperience').value;
            const userEducation = document.getElementById('userEducation').value;
            const userSkills = document.getElementById('userSkills').value;
            const userLanguages = document.getElementById('userLanguages').value;

            if (!userName || !targetRole || !userEmail || !userExperience) {
                showNotification('Compila tutti i campi obbligatori!', 'warning');
                return;
            }

            const loading = document.getElementById('loadingAI');
            const btn = document.querySelector('.btn-large');
            
            btn.disabled = true;
            loading.style.display = 'block';

            try {
                updateOllamaConfig();
                
                // Prepara i dati per l'IA
                const cvData = {
                    nome: userName,
                    ruolo: targetRole,
                    email: userEmail,
                    telefono: userPhone,
                    esperienze: userExperience,
                    formazione: userEducation,
                    competenze: userSkills,
                    lingue: userLanguages
                };

                // Prompt per Ollama
                const prompt = `
Crea un CV professionale in italiano con queste informazioni:

CANDIDATO: ${cvData.nome}
RUOLO DESIDERATO: ${cvData.ruolo}
EMAIL: ${cvData.email}
TELEFONO: ${cvData.telefono}

ESPERIENZE: ${cvData.esperienze}

FORMAZIONE: ${cvData.formazione}

COMPETENZE: ${cvData.competenze}

LINGUE: ${cvData.lingue}

Per favore, crea:
1. Un PROFILO PROFESSIONALE convincente (4-5 righe)
2. Riorganizza le ESPERIENZE in punti elenco professionali
3. Struttura la FORMAZIONE in modo chiaro
4. Organizza le COMPETENZE per categorie
5. Formatta le LINGUE in modo professionale

Restituisci il risultato in formato JSON cos√¨:
{
    "profilo": "testo del profilo...",
    "esperienze": ["punto 1", "punto 2", ...],
    "formazione": ["punto 1", "punto 2", ...],
    "competenze": ["competenza 1", "competenza 2", ...],
    "lingue": ["lingua 1 - livello", "lingua 2 - livello"]
}
`;

                // Chiamata a Ollama
                const response = await fetch(`${ollamaUrl}/api/generate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: ollamaModel,
                        prompt: prompt,
                        stream: false
                    })
                });

                if (!response.ok) {
                    throw new Error('Errore nella chiamata a Ollama');
                }

                const result = await response.json();
                
                // Estrai il JSON dalla risposta
                const aiResponse = result.response;
                const jsonMatch = aiResponse.match(/\{[\s\S]*\}/);
                
                if (jsonMatch) {
                    const cvContent = JSON.parse(jsonMatch[0]);
                    updateCVPreview(cvData, cvContent);
                    showNotification('‚úÖ CV generato con successo con IA!', 'success');
                } else {
                    // Fallback se l'IA non restituisce JSON
                    updateCVPreview(cvData, createFallbackCV(cvData));
                    showNotification('CV generato (modalit√† base)', 'info');
                }

                document.getElementById('downloadBtn').style.display = 'block';

            } catch (error) {
                console.error('Errore IA:', error);
                // Fallback senza IA
                updateCVPreview({
                    nome: userName,
                    ruolo: targetRole,
                    email: userEmail,
                    telefono: userPhone,
                    esperienze: userExperience,
                    formazione: userEducation,
                    competenze: userSkills,
                    lingue: userLanguages
                }, createFallbackCV({
                    nome: userName,
                    ruolo: targetRole,
                    email: userEmail,
                    telefono: userPhone,
                    esperienze: userExperience,
                    formazione: userEducation,
                    competenze: userSkills,
                    lingue: userLanguages
                }));
                showNotification('CV generato (modalit√† base)', 'info');
                document.getElementById('downloadBtn').style.display = 'block';
            } finally {
                btn.disabled = false;
                loading.style.display = 'none';
            }
        }

        function createFallbackCV(data) {
            return {
                profilo: `Professionista motivato specializzato in ${data.ruolo}. Con comprovata esperienza nel settore e forte orientamento ai risultati. Capacit√† di lavorare in team e risolvere problemi complessi.`,
                esperienze: data.esperienze.split('\n').filter(exp => exp.trim()),
                formazione: data.formazione.split('\n').filter(edu => edu.trim()),
                competenze: data.competenze.split(',').map(skill => skill.trim()).filter(skill => skill),
                lingue: data.lingue.split(',').map(lang => lang.trim()).filter(lang => lang)
            };
        }

        function updateCVPreview(data, content) {
            // Aggiorna header
            document.getElementById('previewName').textContent = data.nome;
            document.getElementById('previewRole').textContent = data.ruolo;

            // Aggiorna foto
            const photoFile = document.getElementById('photoFile').files[0];
            if (photoFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewPhoto').src = e.target.result;
                    document.getElementById('previewPhoto').style.display = 'block';
                }
                reader.readAsDataURL(photoFile);
            }

            // Aggiorna contenuti
            document.getElementById('previewProfile').textContent = content.profilo;
            
            // Esperienze
            const expElement = document.getElementById('previewExperience');
            expElement.innerHTML = content.esperienze.map(exp => 
                `<div style="margin-bottom: 8px;">‚Ä¢ ${exp}</div>`
            ).join('');

            // Formazione
            const eduElement = document.getElementById('previewEducation');
            eduElement.innerHTML = content.formazione.map(edu => 
                `<div style="margin-bottom: 8px;">‚Ä¢ ${edu}</div>`
            ).join('');

            // Competenze
            const skillsElement = document.getElementById('previewSkills');
            skillsElement.innerHTML = content.competenze.map(skill => 
                `<div class="skill-tag">${skill}</div>`
            ).join('');

            // Lingue
            const langElement = document.getElementById('previewLanguages');
            langElement.innerHTML = content.lingue.map(lang => 
                `<div style="margin-bottom: 5px;">‚Ä¢ ${lang}</div>`
            ).join('');
        }

        // Download PDF
        function downloadPDF() {
            const element = document.getElementById('cvTemplate');
            const options = {
                margin: 10,
                filename: `CV_${document.getElementById('userName').value}_${new Date().getTime()}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(options).from(element).save();
            showNotification('üìÑ PDF scaricato con successo!', 'success');
        }

        // Notifiche
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 4000);
        }

        // Inizializzazione
        document.addEventListener('DOMContentLoaded', function() {
            showNotification('üöÄ Sistema CV AI pronto! Configura Ollama per usare l\'IA.', 'info');
        });
    </script>
</body>
</html>
